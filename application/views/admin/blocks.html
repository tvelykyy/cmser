{% extends "admin/skeleton.html" %}

{% block main_content %}
<div class="box-content">
    <table class="table table-striped">
        <thead>
            <tr>
                <th>Id</th>
                <th>Title</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody data-bind="foreach: blocks">
            <tr>
                <td data-bind="text: id"></td>
                <td data-bind="text: title" class="center"></td>
                <td>
                    <a class="btn btn-info edit" href="javascript:;"><i class="icon-edit icon-white"></i>Edit</a>
                    <a class="btn btn-danger delete" href="javascript:;"><i class="icon-trash icon-white"></i>Delete</a>
                </td>
            </tr>
        </tbody>
    </table>
    <a id="add-block-button" data-bind="click: clearAndShowModalDialog" class="btn btn-success" href="javascript:;"><i class="icon-plus-sign icon-white"></i>Add</a>
</div>

<div class="modal hide fade" id="myModal">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">Ã—</button>
        <h3>Add Block</h3>
    </div>
    <div class="modal-body">
        <form id= "save-block-form" class="form-horizontal">
            <fieldset>
                <div class="control-group">
                    <input name="id" type="hidden" type="text" data-bind="value: selectedBlock.id">
                    <label class="control-label" for="focusedInput">Block Title</label>
                    <div class="controls">
                        <input name="title" id="focusedInput" class="input-xlarge focused" type="text" data-bind="value: selectedBlock.title">
                    </div>
                </div>
            </fieldset>
        </form>
    </div>
    <div class="modal-footer">
        <a href="javascript:;" class="btn" data-dismiss="modal">Close</a>
        <a id="save-block-btn" href="javascript:;" class="btn btn-success">Save changes</a>
    </div>
</div>
{% endblock %}

{% block js %}
<script>
    /*$('#add-block-button').click(function(e){
        $('#myModal').modal('show');
    });

    $('#save-block-btn').click(function(e){
        $.ajax({
            type: 'POST',
            url: '{{ baseurl }}/sadmin/block',
            data: $('#save-block-form').serialize(),
            success: function(data) {
                $('#myModal').modal('hide');
            }
        });
    });

    $('.edit').click(function(e){
        $('#save-block-form [name="id"]').val(5);
        $('#save-block-form [name="title"]').val($(this).attr('title'));
        $('#myModal').modal('show');
    });*/

    var initialData = [
        {% for block in blocks %}
            {id: {{block.id}}, title: '{{block.title}}'},
        {% endfor %}
    ];

    var blockModel = function(blocks) {
        var self = this;

        self.blocks = ko.observableArray(ko.utils.arrayMap(blocks, function(block) {
            return { id: block.id, title: block.title};
        }));

        self.selectedBlock = {
            id: ko.observable(123),
            title: ko.observable('Bob')
        };

        self.clearModalDialog = function() {
            this.selectedBlock.id(null);
            this.selectedBlock.title('');
        };
        self.clearAndShowModalDialog = function() {
            $('#myModal').modal('show');
            this.clearModalDialog();
        }
    };
    ko.applyBindings(blockModel(initialData));
</script>
{% endblock %}